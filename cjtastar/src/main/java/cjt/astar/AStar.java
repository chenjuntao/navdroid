package cjt.astar;

import android.util.Log;
import com.eclipsesource.v8.V8;
import com.eclipsesource.v8.V8Array;
import com.eclipsesource.v8.V8Object;

import java.util.ArrayList;
import java.util.List;

public class AStar {
    private static String ngraph_graph = "(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.createGraph=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){module.exports=createGraph;var eventify=require(\"ngraph.events\");function createGraph(options){options=options||{};if(\"uniqueLinkId\"in options){console.warn(\"ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\\n\"+\"Use `multigraph` option instead\\n\",\"\\n\",\"Note: there is also change in default behavior: From now on each graph\\n\"+\"is considered to be not a multigraph by default (each edge is unique).\");options.multigraph=options.uniqueLinkId}if(options.multigraph===undefined)options.multigraph=false;var nodes=typeof Object.create===\"function\"?Object.create(null):{},links=[],multiEdges={},nodesCount=0,suspendEvents=0,forEachNode=createNodeIterator(),createLink=options.multigraph?createUniqueLink:createSingleLink,changes=[],recordLinkChange=noop,recordNodeChange=noop,enterModification=noop,exitModification=noop;var graphPart={addNode:addNode,addLink:addLink,removeLink:removeLink,removeNode:removeNode,getNode:getNode,getNodesCount:function(){return nodesCount},getLinksCount:function(){return links.length},getLinks:getLinks,forEachNode:forEachNode,forEachLinkedNode:forEachLinkedNode,forEachLink:forEachLink,beginUpdate:enterModification,endUpdate:exitModification,clear:clear,hasLink:getLink,hasNode:getNode,getLink:getLink};eventify(graphPart);monitorSubscribers();return graphPart;function monitorSubscribers(){var realOn=graphPart.on;graphPart.on=on;function on(){graphPart.beginUpdate=enterModification=enterModificationReal;graphPart.endUpdate=exitModification=exitModificationReal;recordLinkChange=recordLinkChangeReal;recordNodeChange=recordNodeChangeReal;graphPart.on=realOn;return realOn.apply(graphPart,arguments)}}function recordLinkChangeReal(link,changeType){changes.push({link:link,changeType:changeType})}function recordNodeChangeReal(node,changeType){changes.push({node:node,changeType:changeType})}function addNode(nodeId,data){if(nodeId===undefined){throw new Error(\"Invalid node identifier\")}enterModification();var node=getNode(nodeId);if(!node){node=new Node(nodeId,data);nodesCount++;recordNodeChange(node,\"add\")}else{node.data=data;recordNodeChange(node,\"update\")}nodes[nodeId]=node;exitModification();return node}function getNode(nodeId){return nodes[nodeId]}function removeNode(nodeId){var node=getNode(nodeId);if(!node){return false}enterModification();var prevLinks=node.links;if(prevLinks){node.links=null;for(var i=0;i<prevLinks.length;++i){removeLink(prevLinks[i])}}delete nodes[nodeId];nodesCount--;recordNodeChange(node,\"remove\");exitModification();return true}function addLink(fromId,toId,data){enterModification();var fromNode=getNode(fromId)||addNode(fromId);var toNode=getNode(toId)||addNode(toId);var link=createLink(fromId,toId,data);links.push(link);addLinkToNode(fromNode,link);if(fromId!==toId){addLinkToNode(toNode,link)}recordLinkChange(link,\"add\");exitModification();return link}function createSingleLink(fromId,toId,data){var linkId=makeLinkId(fromId,toId);return new Link(fromId,toId,data,linkId)}function createUniqueLink(fromId,toId,data){var linkId=makeLinkId(fromId,toId);var isMultiEdge=multiEdges.hasOwnProperty(linkId);if(isMultiEdge||getLink(fromId,toId)){if(!isMultiEdge){multiEdges[linkId]=0}var suffix=\"@\"+ ++multiEdges[linkId];linkId=makeLinkId(fromId+suffix,toId+suffix)}return new Link(fromId,toId,data,linkId)}function getLinks(nodeId){var node=getNode(nodeId);return node?node.links:null}function removeLink(link){if(!link){return false}var idx=indexOfElementInArray(link,links);if(idx<0){return false}enterModification();links.splice(idx,1);var fromNode=getNode(link.fromId);var toNode=getNode(link.toId);if(fromNode){idx=indexOfElementInArray(link,fromNode.links);if(idx>=0){fromNode.links.splice(idx,1)}}if(toNode){idx=indexOfElementInArray(link,toNode.links);if(idx>=0){toNode.links.splice(idx,1)}}recordLinkChange(link,\"remove\");exitModification();return true}function getLink(fromNodeId,toNodeId){var node=getNode(fromNodeId),i;if(!node||!node.links){return null}for(i=0;i<node.links.length;++i){var link=node.links[i];if(link.fromId===fromNodeId&&link.toId===toNodeId){return link}}return null}function clear(){enterModification();forEachNode(function(node){removeNode(node.id)});exitModification()}function forEachLink(callback){var i,length;if(typeof callback===\"function\"){for(i=0,length=links.length;i<length;++i){callback(links[i])}}}function forEachLinkedNode(nodeId,callback,oriented){var node=getNode(nodeId);if(node&&node.links&&typeof callback===\"function\"){if(oriented){return forEachOrientedLink(node.links,nodeId,callback)}else{return forEachNonOrientedLink(node.links,nodeId,callback)}}}function forEachNonOrientedLink(links,nodeId,callback){var quitFast;for(var i=0;i<links.length;++i){var link=links[i];var linkedNodeId=link.fromId===nodeId?link.toId:link.fromId;quitFast=callback(nodes[linkedNodeId],link);if(quitFast){return true}}}function forEachOrientedLink(links,nodeId,callback){var quitFast;for(var i=0;i<links.length;++i){var link=links[i];if(link.fromId===nodeId){quitFast=callback(nodes[link.toId],link);if(quitFast){return true}}}}function noop(){}function enterModificationReal(){suspendEvents+=1}function exitModificationReal(){suspendEvents-=1;if(suspendEvents===0&&changes.length>0){graphPart.fire(\"changed\",changes);changes.length=0}}function createNodeIterator(){return Object.keys?objectKeysIterator:forInIterator}function objectKeysIterator(callback){if(typeof callback!==\"function\"){return}var keys=Object.keys(nodes);for(var i=0;i<keys.length;++i){if(callback(nodes[keys[i]])){return true}}}function forInIterator(callback){if(typeof callback!==\"function\"){return}var node;for(node in nodes){if(callback(nodes[node])){return true}}}}function indexOfElementInArray(element,array){if(!array)return-1;if(array.indexOf){return array.indexOf(element)}var len=array.length,i;for(i=0;i<len;i+=1){if(array[i]===element){return i}}return-1}function Node(id,data){this.id=id;this.links=null;this.data=data}function addLinkToNode(node,link){if(node.links){node.links.push(link)}else{node.links=[link]}}function Link(fromId,toId,data,id){this.fromId=fromId;this.toId=toId;this.data=data;this.id=id}function hashCode(str){var hash=0,i,chr,len;if(str.length==0)return hash;for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash}function makeLinkId(fromId,toId){return fromId.toString()+\"\uD83D\uDC49 \"+toId.toString()}},{\"ngraph.events\":2}],2:[function(require,module,exports){module.exports=function(subject){validateSubject(subject);var eventsStorage=createEventsStorage(subject);subject.on=eventsStorage.on;subject.off=eventsStorage.off;subject.fire=eventsStorage.fire;return subject};function createEventsStorage(subject){var registeredEvents=Object.create(null);return{on:function(eventName,callback,ctx){if(typeof callback!==\"function\"){throw new Error(\"callback is expected to be a function\")}var handlers=registeredEvents[eventName];if(!handlers){handlers=registeredEvents[eventName]=[]}handlers.push({callback:callback,ctx:ctx});return subject},off:function(eventName,callback){var wantToRemoveAll=typeof eventName===\"undefined\";if(wantToRemoveAll){registeredEvents=Object.create(null);return subject}if(registeredEvents[eventName]){var deleteAllCallbacksForEvent=typeof callback!==\"function\";if(deleteAllCallbacksForEvent){delete registeredEvents[eventName]}else{var callbacks=registeredEvents[eventName];for(var i=0;i<callbacks.length;++i){if(callbacks[i].callback===callback){callbacks.splice(i,1)}}}}return subject},fire:function(eventName){var callbacks=registeredEvents[eventName];if(!callbacks){return subject}var fireArguments;if(arguments.length>1){fireArguments=Array.prototype.splice.call(arguments,1)}for(var i=0;i<callbacks.length;++i){var callbackInfo=callbacks[i];callbackInfo.callback.apply(callbackInfo.ctx,fireArguments)}return subject}}}function validateSubject(subject){if(!subject){throw new Error(\"Eventify cannot use falsy object as events subject\")}var reservedWords=[\"on\",\"fire\",\"off\"];for(var i=0;i<reservedWords.length;++i){if(subject.hasOwnProperty(reservedWords[i])){throw new Error(\"Subject cannot be eventified, since it already has property '\"+reservedWords[i]+\"'\")}}}},{}]},{},[1])(1)});";
    private static String astarjs = "!function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(t,\"__esModule\",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&\"object\"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:t}),2&e&&\"string\"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,\"a\",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p=\"\",n(n.s=2)}([function(t,e,n){var r;t.exports=function t(e,n,i){function o(s,d){if(!n[s]){if(!e[s]){var u=\"function\"==typeof r&&r;if(!d&&u)return r(s,!0);if(a)return a(s,!0);var f=new Error(\"Cannot find module '\"+s+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n||t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var a=\"function\"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){e.exports=function(t){\"uniqueLinkId\"in(t=t||{})&&(console.warn(\"ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\\nUse `multigraph` option instead\\n\",\"\\n\",\"Note: there is also change in default behavior: From now on each graph\\nis considered to be not a multigraph by default (each edge is unique).\"),t.multigraph=t.uniqueLinkId),void 0===t.multigraph&&(t.multigraph=!1);var e,n=\"function\"==typeof Object.create?Object.create(null):{},u=[],f={},c=0,h=0,p=Object.keys?_:F,l=t.multigraph?function(t,e,n){var r=d(t,e),i=f.hasOwnProperty(r);if(i||E(t,e)){i||(f[r]=0);var o=\"@\"+ ++f[r];r=d(t+o,e+o)}return new s(t,e,n,r)}:function(t,e,n){var r=d(t,e);return new s(t,e,n,r)},g=[],I=O,v=O,m=O,N=O,x={addNode:y,addLink:function(t,e,n){m();var r=b(t)||y(t),i=b(e)||y(e),o=l(t,e,n);return u.push(o),a(r,o),t!==e&&a(i,o),I(o,\"add\"),N(),o},removeLink:T,removeNode:k,getNode:b,getNodesCount:function(){return c},getLinksCount:function(){return u.length},getLinks:function(t){var e=b(t);return e?e.links:null},forEachNode:p,forEachLinkedNode:function(t,e,r){var i=b(t);if(i&&i.links&&\"function\"==typeof e)return r?function(t,e,r){for(var i=0;i<t.length;++i){var o=t[i];if(o.fromId===e&&r(n[o.toId],o))return!0}}(i.links,t,e):function(t,e,r){for(var i=0;i<t.length;++i){var o=t[i],a=o.fromId===e?o.toId:o.fromId;if(r(n[a],o))return!0}}(i.links,t,e)},forEachLink:function(t){var e,n;if(\"function\"==typeof t)for(e=0,n=u.length;e<n;++e)t(u[e])},beginUpdate:m,endUpdate:N,clear:function(){m(),p(function(t){k(t.id)}),N()},hasLink:E,hasNode:b,getLink:E};return r(x),e=x.on,x.on=function(){return x.beginUpdate=m=Y,x.endUpdate=N=P,I=S,v=w,x.on=e,e.apply(x,arguments)},x;function S(t,e){g.push({link:t,changeType:e})}function w(t,e){g.push({node:t,changeType:e})}function y(t,e){if(void 0===t)throw new Error(\"Invalid node identifier\");m();var r=b(t);return r?(r.data=e,v(r,\"update\")):(r=new o(t,e),c++,v(r,\"add\")),n[t]=r,N(),r}function b(t){return n[t]}function k(t){var e=b(t);if(!e)return!1;m();var r=e.links;if(r){e.links=null;for(var i=0;i<r.length;++i)T(r[i])}return delete n[t],c--,v(e,\"remove\"),N(),!0}function T(t){if(!t)return!1;var e=i(t,u);if(e<0)return!1;m(),u.splice(e,1);var n=b(t.fromId),r=b(t.toId);return n&&(e=i(t,n.links))>=0&&n.links.splice(e,1),r&&(e=i(t,r.links))>=0&&r.links.splice(e,1),I(t,\"remove\"),N(),!0}function E(t,e){var n,r=b(t);if(!r||!r.links)return null;for(n=0;n<r.links.length;++n){var i=r.links[n];if(i.fromId===t&&i.toId===e)return i}return null}function O(){}function Y(){h+=1}function P(){0==(h-=1)&&g.length>0&&(x.fire(\"changed\",g),g.length=0)}function _(t){if(\"function\"==typeof t)for(var e=Object.keys(n),r=0;r<e.length;++r)if(t(n[e[r]]))return!0}function F(t){var e;if(\"function\"==typeof t)for(e in n)if(t(n[e]))return!0}};var r=t(\"ngraph.events\");function i(t,e){if(!e)return-1;if(e.indexOf)return e.indexOf(t);var n,r=e.length;for(n=0;n<r;n+=1)if(e[n]===t)return n;return-1}function o(t,e){this.id=t,this.links=null,this.data=e}function a(t,e){t.links?t.links.push(e):t.links=[e]}function s(t,e,n,r){this.fromId=t,this.toId=e,this.data=n,this.id=r}function d(t,e){return t.toString()+\"\uD83D\uDC49 \"+e.toString()}},{\"ngraph.events\":2}],2:[function(t,e,n){e.exports=function(t){!function(t){if(!t)throw new Error(\"Eventify cannot use falsy object as events subject\");for(var e=[\"on\",\"fire\",\"off\"],n=0;n<e.length;++n)if(t.hasOwnProperty(e[n]))throw new Error(\"Subject cannot be eventified, since it already has property '\"+e[n]+\"'\")}(t);var e=function(t){var e=Object.create(null);return{on:function(n,r,i){if(\"function\"!=typeof r)throw new Error(\"callback is expected to be a function\");var o=e[n];return o||(o=e[n]=[]),o.push({callback:r,ctx:i}),t},off:function(n,r){var i=void 0===n;if(i)return e=Object.create(null),t;if(e[n]){var o=\"function\"!=typeof r;if(o)delete e[n];else for(var a=e[n],s=0;s<a.length;++s)a[s].callback===r&&a.splice(s,1)}return t},fire:function(n){var r,i=e[n];if(!i)return t;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var o=0;o<i.length;++o){var a=i[o];a.callback.apply(a.ctx,r)}return t}}}(t);return t.on=e.on,t.off=e.off,t.fire=e.fire,t}},{}]},{},[1])(1)},function(t,e,n){var r;t.exports=function t(e,n,i){function o(s,d){if(!n[s]){if(!e[s]){var u=\"function\"==typeof r&&r;if(!d&&u)return r(s,!0);if(a)return a(s,!0);var f=new Error(\"Cannot find module '\"+s+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var c=n[s]={exports:{}};e[s][0].call(c.exports,function(t){var n=e[s][1][t];return o(n||t)},c,c.exports,t,e,n,i)}return n[s].exports}for(var a=\"function\"==typeof r&&r,s=0;s<i.length;s++)o(i[s]);return o}({1:[function(t,e,n){function r(t,e){if(!(this instanceof r))return new r(t,e);if(Array.isArray(t)||(e=t,t=[]),e=e||{},this.data=t||[],this.length=this.data.length,this.compare=e.compare||o,this.setNodeId=e.setNodeId||i,this.length>0)for(var n=this.length>>1;n>=0;n--)this._down(n);if(e.setNodeId)for(var n=0;n<this.length;++n)this.setNodeId(this.data[n],n)}function i(){}function o(t,e){return t-e}e.exports=r,r.prototype={push:function(t){this.data.push(t),this.setNodeId(t,this.length),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var t=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this.setNodeId(this.data[0],0),this._down(0)),this.data.pop(),t}},peek:function(){return this.data[0]},updateItem:function(t){this._down(t),this._up(t)},_up:function(t){for(var e=this.data,n=this.compare,r=this.setNodeId,i=e[t];t>0;){var o=t-1>>1,a=e[o];if(n(i,a)>=0)break;e[t]=a,r(a,t),t=o}e[t]=i,r(i,t)},_down:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t],o=this.setNodeId;t<r;){var a=1+(t<<1),s=a+1,d=e[a];if(s<this.length&&n(e[s],d)<0&&(a=s,d=e[s]),n(d,i)>=0)break;e[t]=d,o(d,t),t=a}e[t]=i,o(i,t)}}},{}],2:[function(t,e,n){e.exports=function(t,e){var n=(e=e||{}).oriented,o=e.heuristic;o||(o=a.heuristic);var f=e.distance;f||(f=a.distance);var c=i();return{find:function(e,i){var h=t.getNode(e);if(!h)throw new Error(\"fromId is not defined in this graph: \"+e);var p=t.getNode(i);if(!p)throw new Error(\"toId is not defined in this graph: \"+i);if(h===p)return[h];c.reset();var l=n?function(t,e){if(b===s){if(e.fromId===k.node.id)return E(t,e,k)}else if(b===d&&e.toId===k.node.id)return E(t,e,k)}:function(t,e){return E(t,e,k)},g=new Map,I=new r({compare:a.compareFScore,setNodeId:a.setHeapIndex}),v=new r({compare:a.compareFScore,setNodeId:a.setHeapIndex}),m=c.createNewState(h);g.set(e,m),m.fScore=o(h,p),m.distanceToSource=0,I.push(m),m.open=s;var N=c.createNewState(p);N.fScore=o(p,h),N.distanceToSource=0,v.push(N),N.open=d;for(var x,S,w=Number.POSITIVE_INFINITY,y=I,b=s;I.length>0&&v.length>0;){I.length<v.length?(b=s,y=I):(b=d,y=v);var k=y.pop();if(k.closed=!0,!(k.distanceToSource>w)&&(t.forEachLinkedNode(k.node.id,l),x&&S))return T(x,S)}return u;function T(t,e){for(var n=[],r=t;r;)n.push(r.node),r=r.parent;for(var i=e;i;)n.unshift(i.node),i=i.parent;return n}function E(t,e,n){var r,i=g.get(t.id);if(i||(i=c.createNewState(t),g.set(t.id,i)),!i.closed)if((r=i.open)&&r!==b){var a=i.distanceToSource+n.distanceToSource;a<w&&(x=i,S=n,w=a)}else{var d=n.distanceToSource+f(i.node,n.node,e);if(!(d>=i.distanceToSource)){var u=b===s?p:h,l=d+o(i.node,u);l>=w||(i.fScore=l,0===i.open&&(y.push(i),y.updateItem(i.heapIndex),i.open=b),i.parent=n,i.distanceToSource=d)}}}}}};var r=t(\"./NodeHeap\"),i=t(\"./makeSearchStatePool\"),o=t(\"./heuristics\"),a=t(\"./defaultSettings\"),s=1,d=2,u=a.NO_PATH;e.exports.l2=o.l2,e.exports.l1=o.l1},{\"./NodeHeap\":1,\"./defaultSettings\":4,\"./heuristics\":5,\"./makeSearchStatePool\":6}],3:[function(t,e,n){e.exports=function(t,e){var n=(e=e||{}).oriented,o=e.heuristic;o||(o=a.heuristic);var u=e.distance;u||(u=a.distance);var f=i();return{find:function(e,i){var c=t.getNode(e);if(!c)throw new Error(\"fromId is not defined in this graph: \"+e);var h=t.getNode(i);if(!h)throw new Error(\"toId is not defined in this graph: \"+i);f.reset();var p,l,g=new Map,I=new r({compare:a.compareFScore,setNodeId:a.setHeapIndex}),v=f.createNewState(c);for(g.set(e,v),v.fScore=o(c,h),v.distanceToSource=0,I.push(v),v.open=1;I.length>0;){if(p=I.pop(),l=h,p.node===l)return d(p);p.closed=!0,t.forEachLinkedNode(p.node.id,m,n)}return s;function m(t,e){var n=g.get(t.id);if(n||(n=f.createNewState(t),g.set(t.id,n)),!n.closed){0===n.open&&(I.push(n),n.open=1);var r=p.distanceToSource+u(t,p.node,e);r>=n.distanceToSource||(n.parent=p,n.distanceToSource=r,n.fScore=r+o(n.node,h),I.updateItem(n.heapIndex))}}}}};var r=t(\"./NodeHeap\"),i=t(\"./makeSearchStatePool\"),o=t(\"./heuristics\"),a=t(\"./defaultSettings.js\"),s=a.NO_PATH;function d(t){for(var e=[t.node],n=t.parent;n;)e.push(n.node),n=n.parent;return e}e.exports.l2=o.l2,e.exports.l1=o.l1},{\"./NodeHeap\":1,\"./defaultSettings.js\":4,\"./heuristics\":5,\"./makeSearchStatePool\":6}],4:[function(t,e,n){var r=[];\"function\"==typeof Object.freeze&&Object.freeze(r),e.exports={heuristic:function(){return 0},distance:function(){return 1},compareFScore:function(t,e){return t.fScore-e.fScore},NO_PATH:r,setHeapIndex:function(t,e){t.heapIndex=e},setH1:function(t,e){t.h1=e},setH2:function(t,e){t.h2=e},compareF1Score:function(t,e){return t.f1-e.f1},compareF2Score:function(t,e){return t.f2-e.f2}}},{}],5:[function(t,e,n){e.exports={l2:function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},l1:function(t,e){var n=t.x-e.x,r=t.y-e.y;return Math.abs(n)+Math.abs(r)}}},{}],6:[function(t,e,n){function r(t){this.node=t,this.parent=null,this.closed=!1,this.open=0,this.distanceToSource=Number.POSITIVE_INFINITY,this.fScore=Number.POSITIVE_INFINITY,this.heapIndex=-1}e.exports=function(){var t=0,e=[];return{createNewState:function(n){var i=e[t];return i?(i.node=n,i.parent=null,i.closed=!1,i.open=0,i.distanceToSource=Number.POSITIVE_INFINITY,i.fScore=Number.POSITIVE_INFINITY,i.heapIndex=-1):(i=new r(n),e[t]=i),t++,i},reset:function(){t=0}}}},{}],7:[function(t,e,n){e.exports=function(t,e){var n=(e=e||{}).oriented,i=e.quitFast,d=e.heuristic;d||(d=o.heuristic);var u=e.distance;u||(u=o.distance);var f=a();return{find:function(e,a){var c=t.getNode(e);if(!c)throw new Error(\"fromId is not defined in this graph: \"+e);var h=t.getNode(a);if(!h)throw new Error(\"toId is not defined in this graph: \"+a);f.reset();var p,l=n?function(t,e){if(e.fromId===y.node.id)return E(t,e)}:E,g=n?function(t,e){if(e.toId===y.node.id)return O(t,e)}:O,I=new Map,v=new r({compare:o.compareF1Score,setNodeId:o.setH1}),m=new r({compare:o.compareF2Score,setNodeId:o.setH2}),N=Number.POSITIVE_INFINITY,x=f.createNewState(c);I.set(e,x),x.g1=0;var S=d(c,h);x.f1=S,v.push(x);var w=f.createNewState(h);I.set(a,w),w.g2=0;var y,b=S;for(w.f2=b,m.push(w);m.length&&v.length&&(v.length<m.length?k():T(),!i||!p););return function(t){if(!t)return s;for(var e=[t.node],n=t.p1;n;)e.push(n.node),n=n.p1;for(var r=t.p2;r;)e.unshift(r.node),r=r.p2;return e}(p);function k(){(y=v.pop()).closed||(y.closed=!0,y.f1<N&&y.g1+b-d(c,y.node)<N&&t.forEachLinkedNode(y.node.id,l),v.length>0&&(S=v.peek().f1))}function T(){(y=m.pop()).closed||(y.closed=!0,y.f2<N&&y.g2+S-d(y.node,h)<N&&t.forEachLinkedNode(y.node.id,g),m.length>0&&(b=m.peek().f2))}function E(t,e){var n=I.get(t.id);if(n||(n=f.createNewState(t),I.set(t.id,n)),!n.closed){var r=y.g1+u(y.node,t,e);r<n.g1&&(n.g1=r,n.f1=r+d(n.node,h),n.p1=y,n.h1<0?v.push(n):v.updateItem(n.h1));var i=n.g1+n.g2;i<N&&(N=i,p=n)}}function O(t,e){var n=I.get(t.id);if(n||(n=f.createNewState(t),I.set(t.id,n)),!n.closed){var r=y.g2+u(y.node,t,e);r<n.g2&&(n.g2=r,n.f2=r+d(c,n.node),n.p2=y,n.h2<0?m.push(n):m.updateItem(n.h2));var i=n.g1+n.g2;i<N&&(N=i,p=n)}}}}};var r=t(\"../NodeHeap\"),i=t(\"../heuristics\"),o=t(\"../defaultSettings.js\"),a=t(\"./makeNBASearchStatePool.js\"),s=o.NO_PATH;e.exports.l2=i.l2,e.exports.l1=i.l1},{\"../NodeHeap\":1,\"../defaultSettings.js\":4,\"../heuristics\":5,\"./makeNBASearchStatePool.js\":8}],8:[function(t,e,n){function r(t){this.node=t,this.p1=null,this.p2=null,this.closed=!1,this.g1=Number.POSITIVE_INFINITY,this.g2=Number.POSITIVE_INFINITY,this.f1=Number.POSITIVE_INFINITY,this.f2=Number.POSITIVE_INFINITY,this.h1=-1,this.h2=-1}e.exports=function(){var t=0,e=[];return{createNewState:function(n){var i=e[t];return i?(i.node=n,i.p1=null,i.p2=null,i.closed=!1,i.g1=Number.POSITIVE_INFINITY,i.g2=Number.POSITIVE_INFINITY,i.f1=Number.POSITIVE_INFINITY,i.f2=Number.POSITIVE_INFINITY,i.h1=-1,i.h2=-1):(i=new r(n),e[t]=i),t++,i},reset:function(){t=0}}}},{}],9:[function(t,e,n){e.exports={aStar:t(\"./a-star/a-star.js\"),aGreedy:t(\"./a-star/a-greedy-star\"),nba:t(\"./a-star/nba/index.js\")}},{\"./a-star/a-greedy-star\":2,\"./a-star/a-star.js\":3,\"./a-star/nba/index.js\":7}]},{},[9])(9)},function(t,e,n){n(3),n(0),t.exports=n(1)},function(t,e,n){(function(t){var e=n(0),r=n(1),i=n(5);t.astar_function={test1:function(){let t=e();return t.addLink(\"a\",\"b\",{weight:3}),t.addLink(\"a\",\"c\",{weight:10}),t.addLink(\"c\",\"d\",{weight:5}),t.addLink(\"b\",\"d\",{weight:10}),r.aStar(t,{distance:(t,e,n)=>n.data.weight}).find(\"a\",\"d\")},test2:function(){let t=e();return t.addLink(\"a\",\"b\"),t.addLink(\"e\",\"b\"),t.addLink(\"a\",\"c\"),t.addLink(\"c\",\"d\"),t.addLink(\"d\",\"e\"),r.aStar(t,{oriented:!0}).find(\"a\",\"e\")},test3:function(){let t=e();return t.addNode(\"NYC\",{x:0,y:0}),t.addNode(\"Boston\",{x:1,y:1}),t.addNode(\"Philadelphia\",{x:-1,y:-1}),t.addNode(\"Washington\",{x:-2,y:-2}),t.addLink(\"NYC\",\"Boston\"),t.addLink(\"NYC\",\"Philadelphia\"),t.addLink(\"Philadelphia\",\"Washington\"),r.aStar(t,{distance:this.distance,heuristic:this.distance}).find(\"NYC\",\"Washington\")},graph:{},xyBBox:new i,ractor:1,initGraph:function(t,n){this.graph=e();for(let e=0;e<t.length;e++){let n=t[e].nodeId,r=t[e].lon*this.ractor,i=t[e].lat*this.ractor;this.graph.addNode(n,{x:r,y:i})}for(let t=0;t<n.length;t++){let e=n[t];this.graph.addLink(e.node1,e.node2,{weight:e.distance})}},findPath:function(t,e){return r.aStar(this.graph,{distance:(t,e,n)=>n.data.weight}).find(t,e)},distance:function(t,e){let n=t.x-e.x,r=t.y-e.y;return Math.sqrt(n*n+r*r)},moveCoordTo0:function(){this.graph.forEachNode(t=>{t.data.x=t.data.x-this.xyBBox.cx,t.data.y=t.data.y-this.xyBBox.cy})},unMoveCoordTo0:function(t){for(let e=0;e<t.length;e++)t[e].data.x=(t[e].data.x+this.xyBBox.cx)/this.ractor,t[e].data.y=(t[e].data.y+this.xyBBox.cy)/this.ractor;return t}}}).call(this,n(4))},function(t,e){var n;n=function(){return this}();try{n=n||new Function(\"return this\")()}catch(t){\"object\"==typeof window&&(n=window)}t.exports=n},function(t,e){t.exports=class{constructor(){this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY}growBy(t){this.minX-=t,this.minY-=t,this.maxX+=t,this.maxY+=t}get left(){return this.minX}get top(){return this.minY}get right(){return this.maxX}get bottom(){return this.maxY}get width(){return this.maxX-this.minX}get height(){return this.maxY-this.minY}get cx(){return(this.minX+this.maxX)/2}get cy(){return(this.minY+this.maxY)/2}addPoint(t,e){if(void 0===t)throw new Error(\"Point is not defined\");let n=t,r=e;void 0===r&&(n=t.x,r=t.y),n<this.minX&&(this.minX=n),n>this.maxX&&(this.maxX=n),r<this.minY&&(this.minY=r),r>this.maxY&&(this.maxY=r)}addRect(t){if(!t)throw new Error(\"rect is not defined\");this.addPoint(t.left,t.top),this.addPoint(t.right,t.top),this.addPoint(t.left,t.bottom),this.addPoint(t.right,t.bottom)}merge(t){t.minX<this.minX&&(this.minX=t.minX),t.minY<this.minY&&(this.minY=t.minY),t.maxX>this.maxX&&(this.maxX=t.maxX),t.maxY>this.maxY&&(this.maxY=t.maxY)}}}]);";

    public static String test() {
        V8 v8 = V8.createV8Runtime();
        v8.executeScript(ngraph_graph);
        V8Array param = new V8Array(v8);
        V8Object g = v8.executeObjectFunction("createGraph", param);

        V8Array params1 = new V8Array(v8).push("a").push("b").push(10);
        g.executeVoidFunction("addLink", params1);
        V8Array params2 = new V8Array(v8).push("d").push("c").push(5);
        g.executeVoidFunction("addLink", params2);

        int nodeCount = g.executeIntegerFunction("getNodesCount", param);
        String result = String.valueOf(nodeCount);


        int linkCount = g.executeIntegerFunction("getLinksCount", param);
        result += String.valueOf(linkCount);

        param.release();
        params1.release();
        params2.release();
        g.release();
        v8.release();

        return result;
    }

    private static V8 v8;
    private static V8Object jsAstar;

    public static boolean initV8() {
        try {
            v8 = V8.createV8Runtime();
            v8.executeScript(astarjs);
            jsAstar = v8.getObject("astar_function");

            return true;
        } catch (Exception ex) {
            System.out.println("初始化V8引擎失败！" + ex.getMessage());
            return false;
        }
    }

    public static void releaseV8(){
        jsAstar.release();
        v8.release();
    }

    public static void astarReadGraph(CjtGraph cjtGraph) {
        V8Array v8Nodes = new V8Array(v8);
        for (CjtNode node : cjtGraph.nodes.values()) {
            V8Object v8Node = new V8Object(v8).add("nodeId", node.nodeId).add("lon", node.lon).add("lat", node.lat);
            v8Nodes.push(v8Node);
            v8Node.release();
        }

        V8Array v8Edges = new V8Array(v8);
        for (CjtEdge edge : cjtGraph.edges) {
            V8Object v8Edge = new V8Object(v8).add("node1", edge.node1).add("node2", edge.node2).add("distance", edge.distance);
            v8Edges.push(v8Edge);
            v8Edge.release();
        }

//        V8Object v8ParmObj = new V8Object(v8).add("nodes", v8Nodes).add("edges", v8Edges);
        V8Array v8Graph = new V8Array(v8).push(v8Nodes).push(v8Edges);
        jsAstar.executeVoidFunction("initGraph", v8Graph);
        v8Graph.release();
        v8Nodes.release();
        v8Edges.release();
    }

    public static List<CjtNode> astarNavRoad(String fromId, String toId) {
        V8Array v8FromTo = new V8Array(v8).push(fromId).push(toId);
        V8Array v8PathNodes = jsAstar.executeArrayFunction("findPath", v8FromTo);
        v8FromTo.release();

        ArrayList<CjtNode> result = new ArrayList<CjtNode>();
        for (int i = 0; i < v8PathNodes.length(); i++) {
            V8Object v8PathNode = v8PathNodes.getObject(i);
            V8Object v8Data = v8PathNode.getObject("data");
            String msg = "id:" + v8PathNode.get("id") + ",{datax:" + v8Data.get("x") + ",datay:" + v8Data.get("y") + "}";
            CjtNode newNode = new CjtNode(String.valueOf(i),
                    Double.parseDouble(v8Data.get("x").toString()),
                    Double.parseDouble(v8Data.get("y").toString()));
            result.add(newNode);
            Log.i("---------------", msg);
            v8Data.release();
            v8PathNode.release();
        }
        Log.i("=============================", "data count is:" + v8PathNodes.length());
        v8PathNodes.release();

        return result;
    }


    public static String ttt() {
        V8 v8 = V8.createV8Runtime();
        v8.executeScript(astarjs);
        V8Array paramNul = new V8Array(v8);
        V8Object jsAstar = v8.getObject("astar_function");

        V8Array v8Graph = new V8Array(v8);
        jsAstar.executeVoidFunction("test1", v8Graph);
        jsAstar.executeVoidFunction("test2", v8Graph);

        V8Array v8PathNodes = jsAstar.executeArrayFunction("test3", v8Graph);
        for (int i = 0; i < v8PathNodes.length(); i++) {
            V8Object v8PathNode = v8PathNodes.getObject(i);
            V8Object v8Data = v8PathNode.getObject("data");
            String msg = "id:" + v8PathNode.get("id") + ",{datax:" + v8Data.get("x") + ",datay:" + v8Data.get("y") + "}";
            Log.i("-------", msg);
            v8Data.release();
            v8PathNode.release();
        }
        v8PathNodes.release();
        v8Graph.release();

        jsAstar.release();
        paramNul.release();
        v8.release();

        return "";
    }
}
