package cjt.navdroid;

import android.util.Log;
import com.eclipsesource.v8.V8;
import com.eclipsesource.v8.V8Array;
import com.eclipsesource.v8.V8Object;

import java.util.ArrayList;
import java.util.List;

public class AStar {
    private static String ngraph_graph="(function(f){if(typeof exports===\"object\"&&typeof module!==\"undefined\"){module.exports=f()}else if(typeof define===\"function\"&&define.amd){define([],f)}else{var g;if(typeof window!==\"undefined\"){g=window}else if(typeof global!==\"undefined\"){g=global}else if(typeof self!==\"undefined\"){g=self}else{g=this}g.createGraph=f()}})(function(){var define,module,exports;return function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r}()({1:[function(require,module,exports){module.exports=createGraph;var eventify=require(\"ngraph.events\");function createGraph(options){options=options||{};if(\"uniqueLinkId\"in options){console.warn(\"ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\\n\"+\"Use `multigraph` option instead\\n\",\"\\n\",\"Note: there is also change in default behavior: From now on each graph\\n\"+\"is considered to be not a multigraph by default (each edge is unique).\");options.multigraph=options.uniqueLinkId}if(options.multigraph===undefined)options.multigraph=false;var nodes=typeof Object.create===\"function\"?Object.create(null):{},links=[],multiEdges={},nodesCount=0,suspendEvents=0,forEachNode=createNodeIterator(),createLink=options.multigraph?createUniqueLink:createSingleLink,changes=[],recordLinkChange=noop,recordNodeChange=noop,enterModification=noop,exitModification=noop;var graphPart={addNode:addNode,addLink:addLink,removeLink:removeLink,removeNode:removeNode,getNode:getNode,getNodesCount:function(){return nodesCount},getLinksCount:function(){return links.length},getLinks:getLinks,forEachNode:forEachNode,forEachLinkedNode:forEachLinkedNode,forEachLink:forEachLink,beginUpdate:enterModification,endUpdate:exitModification,clear:clear,hasLink:getLink,hasNode:getNode,getLink:getLink};eventify(graphPart);monitorSubscribers();return graphPart;function monitorSubscribers(){var realOn=graphPart.on;graphPart.on=on;function on(){graphPart.beginUpdate=enterModification=enterModificationReal;graphPart.endUpdate=exitModification=exitModificationReal;recordLinkChange=recordLinkChangeReal;recordNodeChange=recordNodeChangeReal;graphPart.on=realOn;return realOn.apply(graphPart,arguments)}}function recordLinkChangeReal(link,changeType){changes.push({link:link,changeType:changeType})}function recordNodeChangeReal(node,changeType){changes.push({node:node,changeType:changeType})}function addNode(nodeId,data){if(nodeId===undefined){throw new Error(\"Invalid node identifier\")}enterModification();var node=getNode(nodeId);if(!node){node=new Node(nodeId,data);nodesCount++;recordNodeChange(node,\"add\")}else{node.data=data;recordNodeChange(node,\"update\")}nodes[nodeId]=node;exitModification();return node}function getNode(nodeId){return nodes[nodeId]}function removeNode(nodeId){var node=getNode(nodeId);if(!node){return false}enterModification();var prevLinks=node.links;if(prevLinks){node.links=null;for(var i=0;i<prevLinks.length;++i){removeLink(prevLinks[i])}}delete nodes[nodeId];nodesCount--;recordNodeChange(node,\"remove\");exitModification();return true}function addLink(fromId,toId,data){enterModification();var fromNode=getNode(fromId)||addNode(fromId);var toNode=getNode(toId)||addNode(toId);var link=createLink(fromId,toId,data);links.push(link);addLinkToNode(fromNode,link);if(fromId!==toId){addLinkToNode(toNode,link)}recordLinkChange(link,\"add\");exitModification();return link}function createSingleLink(fromId,toId,data){var linkId=makeLinkId(fromId,toId);return new Link(fromId,toId,data,linkId)}function createUniqueLink(fromId,toId,data){var linkId=makeLinkId(fromId,toId);var isMultiEdge=multiEdges.hasOwnProperty(linkId);if(isMultiEdge||getLink(fromId,toId)){if(!isMultiEdge){multiEdges[linkId]=0}var suffix=\"@\"+ ++multiEdges[linkId];linkId=makeLinkId(fromId+suffix,toId+suffix)}return new Link(fromId,toId,data,linkId)}function getLinks(nodeId){var node=getNode(nodeId);return node?node.links:null}function removeLink(link){if(!link){return false}var idx=indexOfElementInArray(link,links);if(idx<0){return false}enterModification();links.splice(idx,1);var fromNode=getNode(link.fromId);var toNode=getNode(link.toId);if(fromNode){idx=indexOfElementInArray(link,fromNode.links);if(idx>=0){fromNode.links.splice(idx,1)}}if(toNode){idx=indexOfElementInArray(link,toNode.links);if(idx>=0){toNode.links.splice(idx,1)}}recordLinkChange(link,\"remove\");exitModification();return true}function getLink(fromNodeId,toNodeId){var node=getNode(fromNodeId),i;if(!node||!node.links){return null}for(i=0;i<node.links.length;++i){var link=node.links[i];if(link.fromId===fromNodeId&&link.toId===toNodeId){return link}}return null}function clear(){enterModification();forEachNode(function(node){removeNode(node.id)});exitModification()}function forEachLink(callback){var i,length;if(typeof callback===\"function\"){for(i=0,length=links.length;i<length;++i){callback(links[i])}}}function forEachLinkedNode(nodeId,callback,oriented){var node=getNode(nodeId);if(node&&node.links&&typeof callback===\"function\"){if(oriented){return forEachOrientedLink(node.links,nodeId,callback)}else{return forEachNonOrientedLink(node.links,nodeId,callback)}}}function forEachNonOrientedLink(links,nodeId,callback){var quitFast;for(var i=0;i<links.length;++i){var link=links[i];var linkedNodeId=link.fromId===nodeId?link.toId:link.fromId;quitFast=callback(nodes[linkedNodeId],link);if(quitFast){return true}}}function forEachOrientedLink(links,nodeId,callback){var quitFast;for(var i=0;i<links.length;++i){var link=links[i];if(link.fromId===nodeId){quitFast=callback(nodes[link.toId],link);if(quitFast){return true}}}}function noop(){}function enterModificationReal(){suspendEvents+=1}function exitModificationReal(){suspendEvents-=1;if(suspendEvents===0&&changes.length>0){graphPart.fire(\"changed\",changes);changes.length=0}}function createNodeIterator(){return Object.keys?objectKeysIterator:forInIterator}function objectKeysIterator(callback){if(typeof callback!==\"function\"){return}var keys=Object.keys(nodes);for(var i=0;i<keys.length;++i){if(callback(nodes[keys[i]])){return true}}}function forInIterator(callback){if(typeof callback!==\"function\"){return}var node;for(node in nodes){if(callback(nodes[node])){return true}}}}function indexOfElementInArray(element,array){if(!array)return-1;if(array.indexOf){return array.indexOf(element)}var len=array.length,i;for(i=0;i<len;i+=1){if(array[i]===element){return i}}return-1}function Node(id,data){this.id=id;this.links=null;this.data=data}function addLinkToNode(node,link){if(node.links){node.links.push(link)}else{node.links=[link]}}function Link(fromId,toId,data,id){this.fromId=fromId;this.toId=toId;this.data=data;this.id=id}function hashCode(str){var hash=0,i,chr,len;if(str.length==0)return hash;for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash}function makeLinkId(fromId,toId){return fromId.toString()+\"\uD83D\uDC49 \"+toId.toString()}},{\"ngraph.events\":2}],2:[function(require,module,exports){module.exports=function(subject){validateSubject(subject);var eventsStorage=createEventsStorage(subject);subject.on=eventsStorage.on;subject.off=eventsStorage.off;subject.fire=eventsStorage.fire;return subject};function createEventsStorage(subject){var registeredEvents=Object.create(null);return{on:function(eventName,callback,ctx){if(typeof callback!==\"function\"){throw new Error(\"callback is expected to be a function\")}var handlers=registeredEvents[eventName];if(!handlers){handlers=registeredEvents[eventName]=[]}handlers.push({callback:callback,ctx:ctx});return subject},off:function(eventName,callback){var wantToRemoveAll=typeof eventName===\"undefined\";if(wantToRemoveAll){registeredEvents=Object.create(null);return subject}if(registeredEvents[eventName]){var deleteAllCallbacksForEvent=typeof callback!==\"function\";if(deleteAllCallbacksForEvent){delete registeredEvents[eventName]}else{var callbacks=registeredEvents[eventName];for(var i=0;i<callbacks.length;++i){if(callbacks[i].callback===callback){callbacks.splice(i,1)}}}}return subject},fire:function(eventName){var callbacks=registeredEvents[eventName];if(!callbacks){return subject}var fireArguments;if(arguments.length>1){fireArguments=Array.prototype.splice.call(arguments,1)}for(var i=0;i<callbacks.length;++i){var callbackInfo=callbacks[i];callbackInfo.callback.apply(callbackInfo.ctx,fireArguments)}return subject}}}function validateSubject(subject){if(!subject){throw new Error(\"Eventify cannot use falsy object as events subject\")}var reservedWords=[\"on\",\"fire\",\"off\"];for(var i=0;i<reservedWords.length;++i){if(subject.hasOwnProperty(reservedWords[i])){throw new Error(\"Subject cannot be eventified, since it already has property '\"+reservedWords[i]+\"'\")}}}},{}]},{},[1])(1)});";
    private static String astarjs = "!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){\"undefined\"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:\"Module\"}),Object.defineProperty(e,\"__esModule\",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&\"object\"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,\"default\",{enumerable:!0,value:e}),2&t&&\"string\"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,\"a\",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p=\"\",n(n.s=2)}([function(e,t,n){var r;e.exports=function e(t,n,o){function i(u,d){if(!n[u]){if(!t[u]){var f=\"function\"==typeof r&&r;if(!d&&f)return r(u,!0);if(a)return a(u,!0);var s=new Error(\"Cannot find module '\"+u+\"'\");throw s.code=\"MODULE_NOT_FOUND\",s}var c=n[u]={exports:{}};t[u][0].call(c.exports,function(e){var n=t[u][1][e];return i(n||e)},c,c.exports,e,t,n,o)}return n[u].exports}for(var a=\"function\"==typeof r&&r,u=0;u<o.length;u++)i(o[u]);return i}({1:[function(e,t,n){t.exports=function(e){\"uniqueLinkId\"in(e=e||{})&&(console.warn(\"ngraph.graph: Starting from version 0.14 `uniqueLinkId` is deprecated.\\nUse `multigraph` option instead\\n\",\"\\n\",\"Note: there is also change in default behavior: From now on each graph\\nis considered to be not a multigraph by default (each edge is unique).\"),e.multigraph=e.uniqueLinkId),void 0===e.multigraph&&(e.multigraph=!1);var t,n=\"function\"==typeof Object.create?Object.create(null):{},f=[],s={},c=0,h=0,p=Object.keys?F:L,l=e.multigraph?function(e,t,n){var r=d(e,t),o=s.hasOwnProperty(r);if(o||O(e,t)){o||(s[r]=0);var i=\"@\"+ ++s[r];r=d(e+i,t+i)}return new u(e,t,n,r)}:function(e,t,n){var r=d(e,t);return new u(e,t,n,r)},v=[],g=E,I=E,N=E,S=E,m={addNode:b,addLink:function(e,t,n){N();var r=x(e)||b(e),o=x(t)||b(t),i=l(e,t,n);return f.push(i),a(r,i),e!==t&&a(o,i),g(i,\"add\"),S(),i},removeLink:T,removeNode:y,getNode:x,getNodesCount:function(){return c},getLinksCount:function(){return f.length},getLinks:function(e){var t=x(e);return t?t.links:null},forEachNode:p,forEachLinkedNode:function(e,t,r){var o=x(e);if(o&&o.links&&\"function\"==typeof t)return r?function(e,t,r){for(var o=0;o<e.length;++o){var i=e[o];if(i.fromId===t&&r(n[i.toId],i))return!0}}(o.links,e,t):function(e,t,r){for(var o=0;o<e.length;++o){var i=e[o],a=i.fromId===t?i.toId:i.fromId;if(r(n[a],i))return!0}}(o.links,e,t)},forEachLink:function(e){var t,n;if(\"function\"==typeof e)for(t=0,n=f.length;t<n;++t)e(f[t])},beginUpdate:N,endUpdate:S,clear:function(){N(),p(function(e){y(e.id)}),S()},hasLink:O,hasNode:x,getLink:O};return r(m),t=m.on,m.on=function(){return m.beginUpdate=N=_,m.endUpdate=S=P,g=w,I=k,m.on=t,t.apply(m,arguments)},m;function w(e,t){v.push({link:e,changeType:t})}function k(e,t){v.push({node:e,changeType:t})}function b(e,t){if(void 0===e)throw new Error(\"Invalid node identifier\");N();var r=x(e);return r?(r.data=t,I(r,\"update\")):(r=new i(e,t),c++,I(r,\"add\")),n[e]=r,S(),r}function x(e){return n[e]}function y(e){var t=x(e);if(!t)return!1;N();var r=t.links;if(r){t.links=null;for(var o=0;o<r.length;++o)T(r[o])}return delete n[e],c--,I(t,\"remove\"),S(),!0}function T(e){if(!e)return!1;var t=o(e,f);if(t<0)return!1;N(),f.splice(t,1);var n=x(e.fromId),r=x(e.toId);return n&&(t=o(e,n.links))>=0&&n.links.splice(t,1),r&&(t=o(e,r.links))>=0&&r.links.splice(t,1),g(e,\"remove\"),S(),!0}function O(e,t){var n,r=x(e);if(!r||!r.links)return null;for(n=0;n<r.links.length;++n){var o=r.links[n];if(o.fromId===e&&o.toId===t)return o}return null}function E(){}function _(){h+=1}function P(){0==(h-=1)&&v.length>0&&(m.fire(\"changed\",v),v.length=0)}function F(e){if(\"function\"==typeof e)for(var t=Object.keys(n),r=0;r<t.length;++r)if(e(n[t[r]]))return!0}function L(e){var t;if(\"function\"==typeof e)for(t in n)if(e(n[t]))return!0}};var r=e(\"ngraph.events\");function o(e,t){if(!t)return-1;if(t.indexOf)return t.indexOf(e);var n,r=t.length;for(n=0;n<r;n+=1)if(t[n]===e)return n;return-1}function i(e,t){this.id=e,this.links=null,this.data=t}function a(e,t){e.links?e.links.push(t):e.links=[t]}function u(e,t,n,r){this.fromId=e,this.toId=t,this.data=n,this.id=r}function d(e,t){return e.toString()+\"\uD83D\uDC49 \"+t.toString()}},{\"ngraph.events\":2}],2:[function(e,t,n){t.exports=function(e){!function(e){if(!e)throw new Error(\"Eventify cannot use falsy object as events subject\");for(var t=[\"on\",\"fire\",\"off\"],n=0;n<t.length;++n)if(e.hasOwnProperty(t[n]))throw new Error(\"Subject cannot be eventified, since it already has property '\"+t[n]+\"'\")}(e);var t=function(e){var t=Object.create(null);return{on:function(n,r,o){if(\"function\"!=typeof r)throw new Error(\"callback is expected to be a function\");var i=t[n];return i||(i=t[n]=[]),i.push({callback:r,ctx:o}),e},off:function(n,r){var o=void 0===n;if(o)return t=Object.create(null),e;if(t[n]){var i=\"function\"!=typeof r;if(i)delete t[n];else for(var a=t[n],u=0;u<a.length;++u)a[u].callback===r&&a.splice(u,1)}return e},fire:function(n){var r,o=t[n];if(!o)return e;arguments.length>1&&(r=Array.prototype.splice.call(arguments,1));for(var i=0;i<o.length;++i){var a=o[i];a.callback.apply(a.ctx,r)}return e}}}(e);return e.on=t.on,e.off=t.off,e.fire=t.fire,e}},{}]},{},[1])(1)},function(e,t,n){var r;e.exports=function e(t,n,o){function i(u,d){if(!n[u]){if(!t[u]){var f=\"function\"==typeof r&&r;if(!d&&f)return r(u,!0);if(a)return a(u,!0);var s=new Error(\"Cannot find module '\"+u+\"'\");throw s.code=\"MODULE_NOT_FOUND\",s}var c=n[u]={exports:{}};t[u][0].call(c.exports,function(e){var n=t[u][1][e];return i(n||e)},c,c.exports,e,t,n,o)}return n[u].exports}for(var a=\"function\"==typeof r&&r,u=0;u<o.length;u++)i(o[u]);return i}({1:[function(e,t,n){function r(e,t){if(!(this instanceof r))return new r(e,t);if(Array.isArray(e)||(t=e,e=[]),t=t||{},this.data=e||[],this.length=this.data.length,this.compare=t.compare||i,this.setNodeId=t.setNodeId||o,this.length>0)for(var n=this.length>>1;n>=0;n--)this._down(n);if(t.setNodeId)for(var n=0;n<this.length;++n)this.setNodeId(this.data[n],n)}function o(){}function i(e,t){return e-t}t.exports=r,r.prototype={push:function(e){this.data.push(e),this.setNodeId(e,this.length),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this.setNodeId(this.data[0],0),this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},updateItem:function(e){this._down(e),this._up(e)},_up:function(e){for(var t=this.data,n=this.compare,r=this.setNodeId,o=t[e];e>0;){var i=e-1>>1,a=t[i];if(n(o,a)>=0)break;t[e]=a,r(a,e),e=i}t[e]=o,r(o,e)},_down:function(e){for(var t=this.data,n=this.compare,r=this.length>>1,o=t[e],i=this.setNodeId;e<r;){var a=1+(e<<1),u=a+1,d=t[a];if(u<this.length&&n(t[u],d)<0&&(a=u,d=t[u]),n(d,o)>=0)break;t[e]=d,i(d,e),e=a}t[e]=o,i(o,e)}}},{}],2:[function(e,t,n){t.exports=function(e,t){var n=(t=t||{}).oriented,i=t.heuristic;i||(i=a.heuristic);var s=t.distance;s||(s=a.distance);var c=o();return{find:function(t,o){var h=e.getNode(t);if(!h)throw new Error(\"fromId is not defined in this graph: \"+t);var p=e.getNode(o);if(!p)throw new Error(\"toId is not defined in this graph: \"+o);if(h===p)return[h];c.reset();var l=n?function(e,t){if(x===u){if(t.fromId===y.node.id)return O(e,t,y)}else if(x===d&&t.toId===y.node.id)return O(e,t,y)}:function(e,t){return O(e,t,y)},v=new Map,g=new r({compare:a.compareFScore,setNodeId:a.setHeapIndex}),I=new r({compare:a.compareFScore,setNodeId:a.setHeapIndex}),N=c.createNewState(h);v.set(t,N),N.fScore=i(h,p),N.distanceToSource=0,g.push(N),N.open=u;var S=c.createNewState(p);S.fScore=i(p,h),S.distanceToSource=0,I.push(S),S.open=d;for(var m,w,k=Number.POSITIVE_INFINITY,b=g,x=u;g.length>0&&I.length>0;){g.length<I.length?(x=u,b=g):(x=d,b=I);var y=b.pop();if(y.closed=!0,!(y.distanceToSource>k)&&(e.forEachLinkedNode(y.node.id,l),m&&w))return T(m,w)}return f;function T(e,t){for(var n=[],r=e;r;)n.push(r.node),r=r.parent;for(var o=t;o;)n.unshift(o.node),o=o.parent;return n}function O(e,t,n){var r,o=v.get(e.id);if(o||(o=c.createNewState(e),v.set(e.id,o)),!o.closed)if((r=o.open)&&r!==x){var a=o.distanceToSource+n.distanceToSource;a<k&&(m=o,w=n,k=a)}else{var d=n.distanceToSource+s(o.node,n.node,t);if(!(d>=o.distanceToSource)){var f=x===u?p:h,l=d+i(o.node,f);l>=k||(o.fScore=l,0===o.open&&(b.push(o),b.updateItem(o.heapIndex),o.open=x),o.parent=n,o.distanceToSource=d)}}}}}};var r=e(\"./NodeHeap\"),o=e(\"./makeSearchStatePool\"),i=e(\"./heuristics\"),a=e(\"./defaultSettings\"),u=1,d=2,f=a.NO_PATH;t.exports.l2=i.l2,t.exports.l1=i.l1},{\"./NodeHeap\":1,\"./defaultSettings\":4,\"./heuristics\":5,\"./makeSearchStatePool\":6}],3:[function(e,t,n){t.exports=function(e,t){var n=(t=t||{}).oriented,i=t.heuristic;i||(i=a.heuristic);var f=t.distance;f||(f=a.distance);var s=o();return{find:function(t,o){var c=e.getNode(t);if(!c)throw new Error(\"fromId is not defined in this graph: \"+t);var h=e.getNode(o);if(!h)throw new Error(\"toId is not defined in this graph: \"+o);s.reset();var p,l,v=new Map,g=new r({compare:a.compareFScore,setNodeId:a.setHeapIndex}),I=s.createNewState(c);for(v.set(t,I),I.fScore=i(c,h),I.distanceToSource=0,g.push(I),I.open=1;g.length>0;){if(p=g.pop(),l=h,p.node===l)return d(p);p.closed=!0,e.forEachLinkedNode(p.node.id,N,n)}return u;function N(e,t){var n=v.get(e.id);if(n||(n=s.createNewState(e),v.set(e.id,n)),!n.closed){0===n.open&&(g.push(n),n.open=1);var r=p.distanceToSource+f(e,p.node,t);r>=n.distanceToSource||(n.parent=p,n.distanceToSource=r,n.fScore=r+i(n.node,h),g.updateItem(n.heapIndex))}}}}};var r=e(\"./NodeHeap\"),o=e(\"./makeSearchStatePool\"),i=e(\"./heuristics\"),a=e(\"./defaultSettings.js\"),u=a.NO_PATH;function d(e){for(var t=[e.node],n=e.parent;n;)t.push(n.node),n=n.parent;return t}t.exports.l2=i.l2,t.exports.l1=i.l1},{\"./NodeHeap\":1,\"./defaultSettings.js\":4,\"./heuristics\":5,\"./makeSearchStatePool\":6}],4:[function(e,t,n){var r=[];\"function\"==typeof Object.freeze&&Object.freeze(r),t.exports={heuristic:function(){return 0},distance:function(){return 1},compareFScore:function(e,t){return e.fScore-t.fScore},NO_PATH:r,setHeapIndex:function(e,t){e.heapIndex=t},setH1:function(e,t){e.h1=t},setH2:function(e,t){e.h2=t},compareF1Score:function(e,t){return e.f1-t.f1},compareF2Score:function(e,t){return e.f2-t.f2}}},{}],5:[function(e,t,n){t.exports={l2:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},l1:function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.abs(n)+Math.abs(r)}}},{}],6:[function(e,t,n){function r(e){this.node=e,this.parent=null,this.closed=!1,this.open=0,this.distanceToSource=Number.POSITIVE_INFINITY,this.fScore=Number.POSITIVE_INFINITY,this.heapIndex=-1}t.exports=function(){var e=0,t=[];return{createNewState:function(n){var o=t[e];return o?(o.node=n,o.parent=null,o.closed=!1,o.open=0,o.distanceToSource=Number.POSITIVE_INFINITY,o.fScore=Number.POSITIVE_INFINITY,o.heapIndex=-1):(o=new r(n),t[e]=o),e++,o},reset:function(){e=0}}}},{}],7:[function(e,t,n){t.exports=function(e,t){var n=(t=t||{}).oriented,o=t.quitFast,d=t.heuristic;d||(d=i.heuristic);var f=t.distance;f||(f=i.distance);var s=a();return{find:function(t,a){var c=e.getNode(t);if(!c)throw new Error(\"fromId is not defined in this graph: \"+t);var h=e.getNode(a);if(!h)throw new Error(\"toId is not defined in this graph: \"+a);s.reset();var p,l=n?function(e,t){if(t.fromId===b.node.id)return O(e,t)}:O,v=n?function(e,t){if(t.toId===b.node.id)return E(e,t)}:E,g=new Map,I=new r({compare:i.compareF1Score,setNodeId:i.setH1}),N=new r({compare:i.compareF2Score,setNodeId:i.setH2}),S=Number.POSITIVE_INFINITY,m=s.createNewState(c);g.set(t,m),m.g1=0;var w=d(c,h);m.f1=w,I.push(m);var k=s.createNewState(h);g.set(a,k),k.g2=0;var b,x=w;for(k.f2=x,N.push(k);N.length&&I.length&&(I.length<N.length?y():T(),!o||!p););return function(e){if(!e)return u;for(var t=[e.node],n=e.p1;n;)t.push(n.node),n=n.p1;for(var r=e.p2;r;)t.unshift(r.node),r=r.p2;return t}(p);function y(){(b=I.pop()).closed||(b.closed=!0,b.f1<S&&b.g1+x-d(c,b.node)<S&&e.forEachLinkedNode(b.node.id,l),I.length>0&&(w=I.peek().f1))}function T(){(b=N.pop()).closed||(b.closed=!0,b.f2<S&&b.g2+w-d(b.node,h)<S&&e.forEachLinkedNode(b.node.id,v),N.length>0&&(x=N.peek().f2))}function O(e,t){var n=g.get(e.id);if(n||(n=s.createNewState(e),g.set(e.id,n)),!n.closed){var r=b.g1+f(b.node,e,t);r<n.g1&&(n.g1=r,n.f1=r+d(n.node,h),n.p1=b,n.h1<0?I.push(n):I.updateItem(n.h1));var o=n.g1+n.g2;o<S&&(S=o,p=n)}}function E(e,t){var n=g.get(e.id);if(n||(n=s.createNewState(e),g.set(e.id,n)),!n.closed){var r=b.g2+f(b.node,e,t);r<n.g2&&(n.g2=r,n.f2=r+d(c,n.node),n.p2=b,n.h2<0?N.push(n):N.updateItem(n.h2));var o=n.g1+n.g2;o<S&&(S=o,p=n)}}}}};var r=e(\"../NodeHeap\"),o=e(\"../heuristics\"),i=e(\"../defaultSettings.js\"),a=e(\"./makeNBASearchStatePool.js\"),u=i.NO_PATH;t.exports.l2=o.l2,t.exports.l1=o.l1},{\"../NodeHeap\":1,\"../defaultSettings.js\":4,\"../heuristics\":5,\"./makeNBASearchStatePool.js\":8}],8:[function(e,t,n){function r(e){this.node=e,this.p1=null,this.p2=null,this.closed=!1,this.g1=Number.POSITIVE_INFINITY,this.g2=Number.POSITIVE_INFINITY,this.f1=Number.POSITIVE_INFINITY,this.f2=Number.POSITIVE_INFINITY,this.h1=-1,this.h2=-1}t.exports=function(){var e=0,t=[];return{createNewState:function(n){var o=t[e];return o?(o.node=n,o.p1=null,o.p2=null,o.closed=!1,o.g1=Number.POSITIVE_INFINITY,o.g2=Number.POSITIVE_INFINITY,o.f1=Number.POSITIVE_INFINITY,o.f2=Number.POSITIVE_INFINITY,o.h1=-1,o.h2=-1):(o=new r(n),t[e]=o),e++,o},reset:function(){e=0}}}},{}],9:[function(e,t,n){t.exports={aStar:e(\"./a-star/a-star.js\"),aGreedy:e(\"./a-star/a-greedy-star\"),nba:e(\"./a-star/nba/index.js\")}},{\"./a-star/a-greedy-star\":2,\"./a-star/a-star.js\":3,\"./a-star/nba/index.js\":7}]},{},[9])(9)},function(e,t,n){n(3),n(0),e.exports=n(1)},function(e,t,n){(function(e){var t=n(0),r=n(1);e.astar_function={test1:function(){let e=t();return e.addLink(\"a\",\"b\",{weight:3}),e.addLink(\"a\",\"c\",{weight:10}),e.addLink(\"c\",\"d\",{weight:5}),e.addLink(\"b\",\"d\",{weight:10}),r.aStar(e,{distance:(e,t,n)=>n.data.weight}).find(\"a\",\"d\")},test2:function(){let e=t();return e.addLink(\"a\",\"b\"),e.addLink(\"e\",\"b\"),e.addLink(\"a\",\"c\"),e.addLink(\"c\",\"d\"),e.addLink(\"d\",\"e\"),r.aStar(e,{oriented:!0}).find(\"a\",\"e\")},test3:function(){let e=t();return e.addNode(\"NYC\",{x:0,y:0}),e.addNode(\"Boston\",{x:1,y:1}),e.addNode(\"Philadelphia\",{x:-1,y:-1}),e.addNode(\"Washington\",{x:-2,y:-2}),e.addLink(\"NYC\",\"Boston\"),e.addLink(\"NYC\",\"Philadelphia\"),e.addLink(\"Philadelphia\",\"Washington\"),r.aStar(e,{distance:this.distance,heuristic:this.distance}).find(\"NYC\",\"Washington\")},graph:{},pathFinder:{},initGraph:function(e,n){let o=t();for(let t=0;t<e.length;t++){let n=e[t].nodeId,r=e[t].lon,i=e[t].lat;o.addNode(n,{x:r,y:i})}for(let e=0;e<n.length;e++)o.addLink(n[e].node1,n[e].node2);this.pathFinder=r.aStar(o,{distance:this.distance,heuristic:this.distance})},findPath:function(e,t){return this.pathFinder.find(e,t)},distance:function(e,t){let n=1e7*e.x-1e7*t.x,r=1e7*e.y-1e7*t.y;return Math.sqrt(n*n+r*r)}}}).call(this,n(4))},function(e,t){var n;n=function(){return this}();try{n=n||new Function(\"return this\")()}catch(e){\"object\"==typeof window&&(n=window)}e.exports=n}]);";

    public static String test(){
        V8 v8 = V8.createV8Runtime();
        v8.executeScript(ngraph_graph);
        V8Array param = new V8Array(v8);
        V8Object g = v8.executeObjectFunction("createGraph",param);

        V8Array params1 = new V8Array(v8).push("a").push("b").push(10);
        g.executeVoidFunction("addLink", params1);
        V8Array params2 = new V8Array(v8).push("d").push("c").push(5);
        g.executeVoidFunction("addLink", params2);

        int nodeCount = g.executeIntegerFunction("getNodesCount",param);
        String result = String.valueOf(nodeCount);


        int linkCount = g.executeIntegerFunction("getLinksCount",param);
        result += String.valueOf(linkCount);

        param.release();
        params1.release();
        params2.release();
        g.release();
        v8.release();

        return result;
    }

    private static V8 v8;
    private static V8Object jsAstar;
    public static void astarReadGraph(CjtGraph cjtGraph){
        v8 = V8.createV8Runtime();
        v8.executeScript(astarjs);
        V8Array paramNul = new V8Array(v8);
        jsAstar = v8.getObject("astar_function");

        V8Array v8Nodes = new V8Array(v8);
        for (CjtNode node : cjtGraph.nodes){
            V8Object v8Node = new V8Object(v8).add("nodeId", node.nodeId).add("lon", node.lon).add("lat", node.lat);
            v8Nodes.push(v8Node);
            v8Node.release();
        }

        V8Array v8Edges = new V8Array(v8);
        for (CjtEdge edge : cjtGraph.edges) {
            V8Object v8Edge = new V8Object(v8).add("node1", edge.node1).add("node2", edge.node2);
            v8Edges.push(v8Edge);
            v8Edge.release();
        }

//        V8Object v8ParmObj = new V8Object(v8).add("nodes", v8Nodes).add("edges", v8Edges);
        V8Array v8Graph = new V8Array(v8).push(v8Nodes).push(v8Edges);
        jsAstar.executeVoidFunction("initGraph", v8Graph);
        v8Graph.release();
        v8Nodes.release();
        v8Edges.release();

        paramNul.release();

//        jsAstar.release();
//        v8.release();
    }

    public static List<CjtNode> astarNavRoad(String fromId, String toId){
        V8Array v8FromTo = new V8Array(v8).push(fromId).push(toId);
        V8Array v8PathNodes = jsAstar.executeArrayFunction("findPath", v8FromTo);
        v8FromTo.release();

        ArrayList<CjtNode> result = new ArrayList<CjtNode>();
        for (int i=0;i<v8PathNodes.length();i++){
            V8Object v8PathNode = v8PathNodes.getObject(i);
            V8Object v8Data = v8PathNode.getObject("data");
            String msg = "id:"+v8PathNode.get("id")+",{datax:"+v8Data.get("x")+",datay:"+v8Data.get("y")+"}";
            CjtNode newNode = new CjtNode(String.valueOf(i),
                    Double.parseDouble(v8Data.get("x").toString()),
                    Double.parseDouble(v8Data.get("y").toString()));
            result.add(newNode);
            Log.i("----------------------------", msg);
            v8Data.release();
            v8PathNode.release();
        }
        v8PathNodes.release();

        return result;
    }


    public static String ttt(){
        V8 v8 = V8.createV8Runtime();
        v8.executeScript(astarjs);
        V8Array paramNul = new V8Array(v8);
        V8Object jsAstar = v8.getObject("astar_function");

        V8Array v8Graph = new V8Array(v8);
        jsAstar.executeVoidFunction("test1", v8Graph);
        jsAstar.executeVoidFunction("test2", v8Graph);
        V8Array v8PathNodes = jsAstar.executeArrayFunction("test3", v8Graph);

        for (int i=0;i<v8PathNodes.length();i++){
            V8Object v8PathNode = v8PathNodes.getObject(i);
            V8Object v8Data = v8PathNode.getObject("data");
            String msg = "id:"+v8PathNode.get("id")+",{datax:"+v8Data.get("x")+",datay:"+v8Data.get("y")+"}";
            Log.i("----------------------------", msg);
            v8Data.release();
            v8PathNode.release();
        }
        v8PathNodes.release();

        v8Graph.release();

        jsAstar.release();
        paramNul.release();
        v8.release();

        return "";
    }


}
